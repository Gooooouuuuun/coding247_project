<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kosmo.team.project.dao.MemberDAO">

	<insert id="insertMember" parameterType="kosmo.team.project.dto.MemberDTO">
		insert into member(
					m_no
					,name
					,mid
					,password
					,nickname
					,email
					,birthdate
					,phone
					,gender
					,sido_id
					,sigungu_id
					,detail_address
				)
		values(
			(select nvl(max(m_no),0)+1 from member)
			,#{name}
			,#{mid}
			,#{password}
			,#{nickname}
			,#{email}
			,to_date(#{birthday},'YYYY-MM-DD')
			,#{phone}
			,#{gender}
			,#{sido_id}
			,#{sigungu_id}
			,#{detail_address}
		)
	</insert>
	
	
	
	<insert id="insertDetail" parameterType="kosmo.team.project.dto.MemberDTO">
		insert into member_detail(
			member
		)
		values(
			(select max(m_no) from member)
		)
		
	</insert>
	
	<insert id="insertRecoed" parameterType="kosmo.team.project.dto.MemberDTO">
		insert into player_record(
			player
		)
		values(
			(select max(m_no) from member)
		)
		
	</insert>
	
	
	<select id="getmid" parameterType="kosmo.team.project.dto.MemberDTO" resultType="int">
		select count(*)
		from
			member
		where
			mid = #{mid}
	</select>
	
	<select id="updateMemForm" parameterType="kosmo.team.project.dto.MemberDTO" resultType="kosmo.team.project.dto.MemberDTO">
		select
		    m.name
		    ,m.mid
		    ,m.password
		    ,m.nickname
		    ,m.email
		    ,m.phone
		    ,s.name AS "sido"
    		,si.name AS "sigungu"
		    ,m.detail_address
		from
		     member m left join sido s ON m.sido_id = s.sido_id
             		  LEFT JOIN sigungu si ON m.sigungu_id = si.sigungu_id
		where
			mid = #{mid}
	</select>
	
	<update id="updateMem" parameterType="kosmo.team.project.dto.MemberDTO">
		update
			member
		set
			password = #{password}
			,email = #{email}
			,phone = #{phone}
			,sido_id = #{sido_id}
			,sigungu_id = #{sigungu_id}
			,detail_address = #{detail_address}
			,nickname = #{nickname}
		where
			mid = #{mid}
	</update>
	
	
	<!-- 마이페이지에 있는 내정보 가져오기 -->
	<select id="getMyInfo" parameterType="String" resultType="kosmo.team.project.dto.MemberDTO">
		select
		    m.name    
		    ,md.team           
		from
		    member m left join member_detail md on m.m_no = md.member 
		where
			m.mid = #{mid}
	</select>
	
	<!-- 마이페이지에 있는 내기록 가져오기 -->
	<select id="getMyStat" parameterType="String" resultType="kosmo.team.project.dto.MemberDTO">
		select
		    r.games_played
		    ,r.wins
		    ,r.draws
		    ,r.losses
		    ,r.goals_for
		    ,r.goals_assist
		from 
		    member m left join player_record r on m.m_no = r.player
		where
		    m.mid = #{mid}
	</select>
	
	<!-- 예약한 경기장 가져오기 -->
	<select id="getBookedStadium" parameterType="int" resultType="kosmo.team.project.dto.bookingDTO">
		select
		    s.stadium_name
		    ,to_char(b.booking_date, 'YYYY-MM-DD') as "booking_date"
		    ,t.time_range
		from
		    booking b left join stadium s on b.stadium_no = s.stadium_no
		              left join time_table t on b.time_slot = t.time_no
		where
			b.m_no = #{m_no}
			and 
			(sysdate - booking_date) <![CDATA[ <0 ]]>
	</select>
	
	
	
	
	
</mapper>